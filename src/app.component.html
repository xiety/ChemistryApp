<div class="app-container" [class.full-view]="!showControls()">

  <div class="viewer-pane">
    <div class="viewer-background">
      <app-orbital-viewer [n]="n()" [l]="l()" [m]="m()" [resolution]="resolution()" [glow]="glow()"
        [colorTheme]="colorTheme()" [sliceX]="sliceX()" [sliceY]="sliceY()" [sliceZ]="sliceZ()"
        [showIsoLines]="showIsoLines()" [showSurface]="showSurface()" [showCloud]="showCloud()" [showMesh]="showMesh()"
        [showStats]="showStats()" [contourDensity]="contourDensity()"
        [rotationSpeed]="autoRotate() ? rotationSpeed() : 0" [threshold]="surfaceThreshold()" [dithering]="dithering()"
        [opacity]="opacity()" [rayStepCount]="rayStepCount()">
      </app-orbital-viewer>
    </div>

    <div class="viewer-controls">
      <button class="btn-icon glass" (click)="toggleFullScreen()"
        [title]="isFullscreen() ? 'Exit Fullscreen' : 'Enter Fullscreen'">
        @if (isFullscreen()) {
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8 3v3a2 2 0 0 1-2 2H3m18 0h-3a2 2 0 0 1-2-2V3m0 18v-3a2 2 0 0 1 2-2h3M3 16h3a2 2 0 0 1 2 2v3" />
        </svg>
        } @else {
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round"
            d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3" />
        </svg>
        }
      </button>

      <button class="btn-icon glass" (click)="toggleControls()"
        [title]="showControls() ? 'Hide Settings' : 'Show Settings'">
        @if (showControls()) {
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
        </svg>
        } @else {
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
        }
      </button>
    </div>
  </div>

  @if (showControls()) {
  <div class="sidebar">

    <div class="sidebar-inner">

      <div class="panel-section no-top-padding">
        <div class="tab-group">
          <button (click)="activeTab.set('orbitals')" class="tab-link" [class.active]="activeTab() === 'orbitals'">
            Orbitals
            @if(activeTab() === 'orbitals') { <span class="tab-indicator"></span> }
          </button>
          <button (click)="activeTab.set('rendering')" class="tab-link" [class.active]="activeTab() === 'rendering'">
            Rendering
            @if(activeTab() === 'rendering') { <span class="tab-indicator"></span> }
          </button>
        </div>
      </div>

      <div class="tab-content">

        @if (activeTab() === 'orbitals') {
        <div class="stack-large">

          <div class="stack-small">

            <div class="groups-container">
              @for (group of orbitalGroups; track group.n) {
              <div class="group-row">
                <div class="group-label">{{group.n}}</div>
                <div class="group-items">
                  @for (p of group.orbitals; track p.name) {
                  <button (click)="selectPreset(p)" class="btn-chip" [class.active]="isPresetActive(p)"
                    [class.type-s]="p.l === 0" [class.type-p]="p.l === 1" [class.type-d]="p.l === 2"
                    [class.type-f]="p.l === 3" [class.inactive]="!isPresetActive(p)">
                    {{ p.name }}
                  </button>
                  }
                </div>
              </div>
              }
            </div>

          </div>

          <div class="divider"></div>

          <div class="stack-medium">
            <app-slider label="Principal (n)" [value]="n()" [min]="1" [max]="7" (valueChange)="n.set($event)"
              [valueFormatter]="formatInt" />

            <app-slider label="Azimuthal (l)" [value]="l()" [min]="0" [max]="n() - 1" (valueChange)="l.set($event)"
              [valueFormatter]="formatL" />

            <app-slider label="Magnetic (m)" [value]="m()" [min]="0" [max]="l()" (valueChange)="m.set($event)"
              [valueFormatter]="formatInt" />
          </div>

        </div>
        }

        @if (activeTab() === 'rendering') {
        <div class="stack-large">

          <div class="stack-small">
            <div class="segment-group">
              <button (click)="colorTheme.set(0)" class="btn-segment" [class.active]="colorTheme() === 0"
                [class.inactive]="colorTheme() !== 0">Standard</button>
              <button (click)="colorTheme.set(1)" class="btn-segment" [class.active]="colorTheme() === 1"
                [class.inactive]="colorTheme() !== 1">Cyber</button>
              <button (click)="colorTheme.set(2)" class="btn-segment" [class.active]="colorTheme() === 2"
                [class.inactive]="colorTheme() !== 2">Heatmap</button>
            </div>

            <div class="grid-2">
              <button (click)="toggleCloud()" class="btn-tile" [class.active]="showCloud()"
                [class.inactive]="!showCloud()">
                <span class="dot" [class.on]="showCloud()" [class.off]="!showCloud()"></span>
                Cloud
              </button>

              <button (click)="toggleSurface()" class="btn-tile" [class.active]="showSurface()"
                [class.inactive]="!showSurface()">
                <span class="dot" [class.on]="showSurface()" [class.off]="!showSurface()"></span>
                Surface (GPU)
              </button>

              <button (click)="toggleIsoLines()" class="btn-tile" [class.active]="showIsoLines()"
                [class.inactive]="!showIsoLines()">
                <span class="dot" [class.on]="showIsoLines()" [class.off]="!showIsoLines()"></span>
                Lines
              </button>

              <button (click)="toggleMesh()" class="btn-tile" [class.active]="showMesh()"
                [class.inactive]="!showMesh()">
                <span class="dot" [class.on]="showMesh()" [class.off]="!showMesh()"></span>
                Mesh (CPU)
              </button>
            </div>
          </div>

          <div class="divider"></div>

          <div class="stack-small">
            <app-slider label="Ray Steps (Quality)" [value]="rayStepCount()" [min]="32" [max]="256" [step]="16"
              (valueChange)="rayStepCount.set($event)" [valueFormatter]="formatInt" />

            <app-slider label="Surface Threshold" [value]="surfaceThreshold()" [min]="0.01" [max]="1.0" [step]="0.01"
              (valueChange)="surfaceThreshold.set($event)" [valueFormatter]="formatFloat2" />

            <app-slider label="Contour Frequency" [value]="contourDensity()" [min]="20" [max]="200" [step]="10"
              (valueChange)="contourDensity.set($event)" [valueFormatter]="formatInt" />

            @if(showCloud()) {
            <app-slider label="Glow Intensity" [value]="glow()" [min]="0.5" [max]="3.0" [step]="0.1"
              (valueChange)="glow.set($event)" [valueFormatter]="formatFloat1" />
            }

            @if(showMesh()) {
            <app-slider label="Grid Resolution" [value]="resolution()" [min]="64" [max]="128" [step]="8"
              (valueChange)="resolution.set($event)" [valueFormatter]="formatResolution" />
            }

            @if(showMesh() || showSurface()) {
            <app-slider label="Opacity" [value]="opacity()" [min]="0.1" [max]="1.0" [step]="0.05"
              (valueChange)="opacity.set($event)" [valueFormatter]="formatFloat2" />
            }
          </div>

          <div class="divider"></div>

          <div class="stack-small">
            <app-slider label="Cut X" [value]="sliceX()" [min]="-1.0" [max]="1.0" [step]="0.05"
              (valueChange)="sliceX.set($event)" [valueFormatter]="formatFloat2" />
            <app-slider label="Cut Y" [value]="sliceY()" [min]="-1.0" [max]="1.0" [step]="0.05"
              (valueChange)="sliceY.set($event)" [valueFormatter]="formatFloat2" />
            <app-slider label="Cut Z" [value]="sliceZ()" [min]="-1.0" [max]="1.0" [step]="0.05"
              (valueChange)="sliceZ.set($event)" [valueFormatter]="formatFloat2" />
          </div>

          <div class="divider"></div>

          <div class="stack-small">
            <app-switch label="Rotate" [checked]="autoRotate()" (checkedChange)="autoRotate.set($event)" />

            <app-slider label="Rotation Speed" [value]="rotationSpeed()" [min]="-2.0" [max]="2.0" [step]="0.1"
              (valueChange)="rotationSpeed.set($event)" [markers]="[0]" [valueFormatter]="formatFloat1" />

            <app-slider label="Dithering" [value]="dithering()" [min]="0" [max]="1" [step]="0.01"
              (valueChange)="dithering.set($event)" [valueFormatter]="formatFloat2" />

            <app-switch label="Show Performance Stats (FPS)" [checked]="showStats()"
              (checkedChange)="toggleStats($event)" />
          </div>

        </div>
        }
        <a class="app-link" href="https://github.com/xiety/ChemistryApp">https://github.com/xiety/ChemistryApp</a>
      </div>

    </div>
  </div>
  }
</div>
